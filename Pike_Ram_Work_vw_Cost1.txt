/****** Object:  View [dbo].[vw_Cost1]    Script Date: 05-22-2020 17:44:34 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[vw_Cost1] AS select * from (   

select 	

	exptype.expendituretypeexpendituretypename as EXPENDITURE_TYPE_NAME,
	convert(numeric(25,2),pcd.[PROJECTCOSTDISTRIBUTIONPEOPROJFUNCBURDENEDCOST]) as total_cost ,
	ClassCode.[CLASSCODE] as CLASS_CODE,
	classcat.[CLASSCATEGORY] as CLASS_CATEGORY  ,
	TASK.[PROJECTBASEPEOPROJECTID] as project_id,
	TASK.[PROJELEMENTID] as Task_Id,
	TASK.[TASKSTRUCTUREBASEPEOELEMENTNUMBER] as Task_Number ,
	TASK.[TASKSTRUCTURETRANSLATIONPEONAME] as WorkOrder,
	TASK.[TASKSTRUCTUREBASEPEOCHARGEABLEFLAG] as chargeable_flag,
	TASK.[TASKSTRUCTUREBASEPEOBILLABLEFLAG] as billable_flag,
	TASK.[TASKSTRUCTUREBASEPEOPLANNINGENDDATE] as planned_finish_date,
	Proj.[PROJECTBASEPEOSEGMENT1] Project_Number,
	--ProjNames.[NAME] as Project_Name,
	PRoj.[PROJECTCODESPEOTEXTATTR10] as Contract_Type ,
	ExpCategory.[EXPENDITURECATEGORYID] as expenditure_category_id,
	ExpCategory.[EXPENDITURECATEGORYNAME] as expenditure_category_name   ,
	ExpType.[EXPENDITURETYPEID] as expenditure_type_id,
	WEK.[CALWEEKENDDATE] Week_End_Date,
	fisday.[FISCALYEARNUMBER] + '-'  +  left(fisday.[FISCALPERIODNAME],3) as Accounting_Period_Name,
	fisday.reportdate as Accounting_Date,
	case when ([EXPENDITURETYPEEXPENDITURETYPENAME] IN('Billable Contract Labor - Doubletime','Billable Contract Labor - Overtime','Billable Contract Labor - Regular','Productive Labor - Doubletime','Productive Labor - Overtime','Productive Labor - Regular'))
	Then convert(numeric(25,2),pcd.[PROJECTCOSTDISTRIBUTIONPEOQUANTITY]) else 0 end as PRoduction_Hours,
	'Cost' QueryType


	from 
	(select  distinct [EXPENDITUREITEMID],[EXPENDITUREITEMPEOPARENTLINENUMBER], [PROJECTCOSTDISTRIBUTIONPEOPROJECTID], [PROJECTCOSTDISTRIBUTIONPEOTASKID], [PROJECTCOSTDISTRIBUTIONPEOPRVDRGLDATE],[PROJECTCOSTDISTRIBUTIONPEOORGID], [PROJECTCOSTDISTRIBUTIONPEOQUANTITY],[PROJECTCOSTDISTRIBUTIONPEOPROJFUNCBURDENEDCOST]  from   [dbo].[temp_EXT_Fscmtopmodelam_pjctransactionsam_projectcostdistributionpvo]) pcd,                                                                                        
	(select distinct  [PROJECTBASEPEOSEGMENT1],[PROJECTCODESPEOTEXTATTR10], [PROJECTCODESPEOTEXTATTR12], [PROJECTID],[PROJECTCODESPEOTEXTATTR03], [PROJECTCODESPEOTEXTATTR11] from [dbo].[temp_EXT_fscmtopmodelam_pjfprojectam_project]) proj,                                                                                   
	(select distinct [FISCALYEARNUMBER],[FISCALPERIODNAME], reportdate, FISCALPERIODSETNAME, FISCALPERIODTYPE,[FISCALPERIODADJUSTMENTPERIODFLAG] from [dbo].[temp_EXT_fscmtopmodelam_finglcalaccam_fiscaldaypvo]) fisday,                                                                                    
	(Select distinct [LEDGERPERIODSETNAME],[LEDGERACCOUNTEDPERIODTYPE],[LEDGERID] from  [dbo].[temp_EXT_fscmtopmodelam_finglledgerdefnam_ledgerpvo] ) ledger,                                                                                       
	(Select distinct [EXPENDITUREITEMID],[EXPENDITUREITEMPEOEXPENDITURETYPEID] from [dbo].[temp_EXT_fscmtopmodelam_pjctransactionsam_expenditureitempvo]) expitem,                                                                                     
	(Select distinct  [EXPENDITURETYPEEXPENDITURECATEGORYID],[EXPENDITURETYPEID],[EXPENDITURETYPEEXPENDITURETYPENAME] from [dbo].[temp_EXT_fscmtopmodelam_pjfsetuptransactionsam_expendituretypeview] ) exptype,                                                                                     
	(select distinct [PJFPROJECTCLASSESPROJECTID], [PJFPROJECTCLASSESCLASSCATEGORYID],[PJFPROJECTCLASSESCLASSCODEID] from [dbo].[temp_EXT_fscmtopmodelam_pjfsetupprojectsam_projectclass] )projclass,                                                                                        
	(Select distinct [CLASSCATEGORYID],[CLASSCATEGORY] from [dbo].[temp_EXT_fscmtopmodelam_pjfsetupprojectsam_classcategorytranslation] ) classcat,                                                                                   
	(select distinct [PROJELEMENTID],[TASKSTRUCTURETRANSLATIONPEONAME], [PROJECTBASEPEOPROJECTID],[TASKSTRUCTUREBASEPEOELEMENTNUMBER],[TASKSTRUCTUREBASEPEOCHARGEABLEFLAG], [TASKSTRUCTUREBASEPEOBILLABLEFLAG],[TASKSTRUCTUREBASEPEOPLANNINGENDDATE]  from [dbo].[temp_EXT_fscmtopmodelam_pjfprojectdefinitionam_taskpvo]) task,
	(select distinct [CALWEEK],[CALWEEKENDDATE]  from [dbo].[temp_EXT_hcmtopmodelanalyticsglobalam_gregoriancalendaram_fndcalweek]) WEK,
	(select distinct [PARENTWEEK], [REPORTDATE] from [dbo].[temp_EXT_hcmtopmodelanalyticsglobalam_gregoriancalendaram_fndcalday]) fndcaldayeo,
	(select distinct [ORGANIZATIONINFORMATIONPEOORGINFORMATION3],ORGANIZATIONINFORMATIONPEOORGANIZATIONID,[ORGANIZATIONINFORMATIONPEOORGINFORMATIONCONTEXT], [EFFECTIVESTARTDATE], [EFFECTIVEENDDATE]  from [dbo].[temp_EXT_hcmtopmodelanalyticsglobalam_organizationam_organizationinformationpvo]) expenditurebupeo,
	(Select distinct [CLASSCODEID],[CLASSCODE] from  temp_EXT_fscmtopmodelam_pjfsetupprojectsam_classcodetranslation) ClassCode,
	--(Select distinct [NAME], [PROJECTID] from temp_EXT_fscmtopmodelam_pjfprojectam_projecttranslation) ProjNames,
	(Select distinct [EXPENDITURECATEGORYID],[EXPENDITURECATEGORYNAME]  from temp_EXT_fscmtopmodelam_pjfsetuptransactionsam_expenditurecategorytranslation) ExpCategory

	where pcd.Projectcostdistributionpeoprojectid=proj.[PROJECTID]                                                                                                                                                                                                                                                                       
	and pcd.projectcostdistributionpeoprvdrgldate=fisday.reportdate                                                                                        
	and fisday.FISCALPERIODSETNAME = ledger.[LEDGERPERIODSETNAME]                                                                                   
	AND fisday.FISCALPERIODTYPE = ledger.[LEDGERACCOUNTEDPERIODTYPE]                                                                                       
	and fisday.[FISCALPERIODADJUSTMENTPERIODFLAG]='N'                                                                                        
	and exptype.expendituretypeid=expitem.expenditureitempeoexpendituretypeid                                                                                     
	and expitem.expenditureitemid=pcd.expenditureitemid                                                                                      
	and projclass.[PJFPROJECTCLASSESPROJECTID]=proj.[PROJECTID]                                                                                     
	and projclass.[PJFPROJECTCLASSESCLASSCATEGORYID]=classcat.[CLASSCATEGORYID]                                                                                   
	and classcat.[CLASSCATEGORY]='Line of Business'                                                                                   
	and task.[PROJELEMENTID]=pcd.[projectcostdistributionpeotaskid]                                                                                        
	and task.[PROJECTBASEPEOPROJECTID]=pcd.Projectcostdistributionpeoprojectid                                                                                    
	and task.[PROJECTBASEPEOPROJECTID]=proj.[PROJECTID]                                                                                      
	and fndcaldayeo.[PARENTWEEK]=wek.[CALWEEK] 
	AND pcd.projectcostdistributionpeoprvdrgldate = fndcaldayeo.[REPORTDATE]    
	AND expenditurebupeo.[ORGANIZATIONINFORMATIONPEOORGINFORMATION3] = ledger.[LEDGERID]
	AND pcd.[PROJECTCOSTDISTRIBUTIONPEOORGID] = expenditurebupeo.ORGANIZATIONINFORMATIONPEOORGANIZATIONID
	AND ( 'FUN_BUSINESS_UNIT' ) = expenditurebupeo.[ORGANIZATIONINFORMATIONPEOORGINFORMATIONCONTEXT]
	AND ('2018-03-26' BETWEEN expenditurebupeo.[EFFECTIVESTARTDATE] AND expenditurebupeo.[EFFECTIVEENDDATE])
	AND projclass.[PJFPROJECTCLASSESCLASSCODEID] =ClassCode.[CLASSCODEID]
	--AND Proj.[PROJECTID]=ProjNames.[PROJECTID]
	AND expCategory.[EXPENDITURECATEGORYID]=exptype.[EXPENDITURETYPEEXPENDITURECATEGORYID]
	)a;
GO


