
Development DB Details:
Server: pikeedwdevdw.database.windows.net
DB Name: PikeedwDevDW
Username: DevDW1
Password: Pike123!


UAT DB Details: 
DB: PikeedwUATDW
Server: pikeedwuatdw.database.windows.net
Username: UatDW
Pwd: Pike123!




UAT ADLS NAme : pikeedwuatadls 
UST AAS :  pikeedwuataas

UAT AAS Server Name : asazure://aspaaseastus2.asazure.windows.net/pikeedwuataas
UAT AAS Management Server Name : asazure://aspaaseastus2.asazure.windows.net/pikeedwuataas:rw
asazure://aspaaseastus2.asazure.windows.net/pikeedwdevaas

Things to Do:

1.	Identify the PVOs based on the new Model. 
2.	Extraction process for the above WWOR PVOs. 
	Create ADF in UAT -- Done
3.	Move pipelines of DEV ADF to UAT ADF
4.	Create UAT DB -- Done (Shashank team)
5.	Create External Tables in UAT DB.
6.	Connect the model to UAT External Tables 
7.	Deploy the model into New AAS (pikeedwuataas)
8.	

Productivity matrix: 

Pike Daily Task WO CU Service Item Upload File  02-07-2020.xlsx
WMS_WO_Export.txt



SQL Server connection details: (WWOR DB)

ServerName                   :	10.50.10.170
Login Username               :	WWOR_Read 
Password                     :	..Readonly


SQL Server connection details for PikeWMS database.                                                                                                                                     

Server		:		DCV-DMZSQL01 (10.1.2.20)                                        
LoginUser	:		svc_edw_read    
Pwd			:		..readonly



let
    Source = Sql.Database("pikeedwdevdw.database.windows.net", "pikeedwdevdw"),
    #"dbo_Export-PowerBi-Summary-V1" = Source{[Schema="dbo",Item="Export-PowerBi-Summary-V1"]}[Data]
in
    #"dbo_Export-PowerBi-Summary-V1"


let
    Source = Csv.Document(File.Contents("D:\Productivity_Matrix\PBI_SampleFiles\Export-PowerBi-Summary-V1.csv"),
    [Delimiter=",", Columns=15, Encoding=65001, QuoteStyle=QuoteStyle.None]),
    #"Promoted Headers" = Table.PromoteHeaders(Source, [PromoteAllScalars=true]),
    #"Changed Type" = Table.TransformColumnTypes(#"Promoted Headers",{{"Wonum", type text}, {"Job Number", type text}, {"Zone", type text}, {"Location Name", type text}, {"Employee Name", type text}, {"Maximo Status", type text}, {"Task Completion Date", type date}, {"As Designed Hours", type number}, {"As Built Hours", type number}, {"Productive Hours", type number}, {"CU Hours", type number}, {"Work Type", type text}, {"LOB", type text}, {"Month", type date}, {"Area Supervisor", type text}})
in
    #"Changed Type"


let
    Source = Sql.Database("pikeedwdevdw.database.windows.net", "pikeedwdevdw"),
    #"dbo_Export-PowerBi-Summary-V1" = Source{[Schema="dbo",Item="Export-PowerBi-Summary-V1"]}[Data],
    #"Changed Type" = Table.TransformColumnTypes(#"dbo_Export-PowerBi-Summary-V1",{{"Month", type date}})
in
    #"Changed Type"

let
    Source = Sql.Database("pikeedwdevdw.database.windows.net", "pikeedwdevdw"),
    dbo_PM_Productivity_Matrix_Summary = Source{[Schema="dbo",Item="PM_Productivity_Matrix_Summary"]}[Data],
    #"Changed Type" = Table.TransformColumnTypes(#"dbo_PM_Productivity_Matrix_Summary",{{"Month", type date}})
in
    #"Changed Type"
	
	
let
    Source = Sql.Databases("pikeedwdevdw.database.windows.net"),
    PikeedwDevDW = Source{[Name="PikeedwDevDW"]}[Data],
    dbo_PM_Lastupdate_date = PikeedwDevDW{[Schema="dbo",Item="PM_Lastupdate_date"]}[Data]
in
    dbo_PM_Lastupdate_date

--- Working  Code

let
    Source = Sql.Database("pikeedwdevdw.database.windows.net", "pikeedwdevdw"),
    dbo_PM_Productivity_Matrix_Summary = Source{[Schema="dbo",Item="PM_Productivity_Matrix_Summary"]}[Data],
    #"Changed Type" = Table.TransformColumnTypes(#"dbo_PM_Productivity_Matrix_Summary",{{"Month", type date}})
in
    #"Changed Type"
-------------------------------
=======================
let
    Source = Sql.Database("pikeedwdevdw.database.windows.net", "pikeedwdevdw", [Query="SELECT  [Wonum]#(lf)      ,[Job Number]#(lf)      ,case  when [Zone] = 'Charlotte' then 'Central' else [Zone] end as [Zone]#(lf)      ,[Location Name]#(lf)      ,[Employee Name]#(lf)      ,[Maximo Status]#(lf)      ,[Task Completion Date]#(lf)      ,[As Designed Hours]#(lf)      ,[As Built Hours]#(lf)      ,[Productive Hours]#(lf)      ,[CU Hours]#(lf)      ,case when [Work Type]='MAJOR PROJECTS' then 'Major Projects' else [Work Type] end as [Work Type]#(lf)      ,[LOB]#(lf)      ,[Month]#(lf)      ,[Area Supervisor]#(lf)  FROM [dbo].[PM_Productivity_Matrix_Summary]"]),
    #"Changed Type" = Table.TransformColumnTypes(Source,{{"Month", type date}})
in
    #"Changed Type"
============================	


let
    Source = #"SQL/pikeedwdevdw database windows net;PikeedwDevDW",
   Contract_Header_Lines_Query = 
    Value.NativeQuery(
        #"SQL/pikeedwdevdw database windows net;PikeedwDevDW",
        "
select
		distinct
			ContractLineBasePEOId,
			ContractLineBasePEOChrId,
			ContractLineBasePEOLineNumber,
			ContractLineBasePEOVersionType,
			CONTRACTLINEBASEPEOSTSCODE,
			ContractLineCloseReason
	From
		[dbo].[EXT_fscmtopmodelam_contractscoream_contractheaderlinesp]
		"
    )
in
    Contract_Header_Lines_Query

let
    Source = Sql.Database("pikeedwdevdw.database.windows.net", "pikeedwdevdw"),
   Productivity_Matrix_Query = 
    Value.NativeQuery(
        #"SQL/pikeedwdevdw database windows net;pikeedwdevdw",
        "
SELECT  [Wonum]
      ,[Job Number]
      ,case  when [Zone] = 'Charlotte' then 'Central' else [Zone] end as [Zone]
      ,[Location Name]
      ,[Employee Name]
      ,[Maximo Status]
      ,[Task Completion Date]
      ,[As Designed Hours]
      ,[As Built Hours]
      ,[Productive Hours]
      ,[CU Hours]
      ,[Work Type]
      ,[LOB]
      ,[Month]
      ,[Area Supervisor]
  FROM [dbo].[PM_Productivity_Matrix_Summary]

		"
    )
in
    Productivity_Matrix_Query
let
    Source = Sql.Database("pikeedwdevdw.database.windows.net", "pikeedwdevdw", [Query="SELECT  [Wonum]#(lf)      ,[Job Number]#(lf)      ,case  when [Zone] = 'Charlotte' then 'Central' else [Zone] end as [Zone]#(lf)      ,[Location Name]#(lf)      ,[Employee Name]#(lf)      ,[Maximo Status]#(lf)      ,[Task Completion Date]#(lf)      ,[As Designed Hours]#(lf)      ,[As Built Hours]#(lf)      ,[Productive Hours]#(lf)      ,[CU Hours]#(lf)      ,case when [Work Type]='MAJOR PROJECTS' then 'Major Projects' else [Work Type] end as [Work Type]#(lf)      ,[LOB]#(lf)      ,[Month]#(lf)      ,[Area Supervisor]#(lf)  FROM [dbo].[PM_Productivity_Matrix_Summary]"]),
    #"Changed Type" = Table.TransformColumnTypes(Source,{{"Month", type date}})
in
    #"Changed Type"


let
    Source = Sql.Database("pikeedwdevdw.database.windows.net", "pikeedwdevdw"),
    dbo_PM_Productivity_Matrix_Summary = Source{[Schema="dbo",Item="PM_Productivity_Matrix_Summary"]}[Data],
    #"Changed Type" = Table.TransformColumnTypes(#"dbo_PM_Productivity_Matrix_Summary",{{"Month", type date}}),
    #"Replaced Value" = Table.ReplaceValue(#"Changed Type","Charlotte","Central",Replacer.ReplaceText,{"Zone"})
in
    #"Replaced Value"

Produtivity Factor1 = if( sum(PM_Productivity_Matrix_Summary[As Built Hours])<>0, 
(sum('PM_Productivity_Matrix_Summary'[Productive Hours])/sum('PM_Productivity_Matrix_Summary'[As Built Hours])),BLANK())

Redline Factor1 = if( sum('PM_Productivity_Matrix_Summary'[As Designed Hours])<>0, 
(sum('PM_Productivity_Matrix_Summary'[As Built Hours])/ sum('PM_Productivity_Matrix_Summary'[As Designed Hours])),BLANK())

WorkType = if('PM_Productivity_Matrix_Summary (2)'[Work Type]="MAJOR PROJECTS","Major Projects",'PM_Productivity_Matrix_Summary (2)'[Work Type])



Zone 1 = if('PM_Productivity_Matrix_Summary (2)'[Zone]="Charlotte","Central",'PM_Productivity_Matrix_Summary (2)'[Zone])

Work Type1 = if('PM_Productivity_Matrix_Summary'[Work Type]="MAJOR PROJECTS","Major Projects",'PM_Productivity_Matrix_Summary'[Work Type])

Zone1 = if(PM_Productivity_Matrix_Summary[Zone]="Charlotte","Central",PM_Productivity_Matrix_Summary[Zone])



	